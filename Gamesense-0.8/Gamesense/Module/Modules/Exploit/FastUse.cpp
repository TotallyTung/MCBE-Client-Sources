#include "FastUse.h"

bool onlyBottles;
using namespace std;
FastUse::FastUse() : IModule(0, Category::EXPLOIT, "Be able to use items like EXP, Splash Potions and more very fast") {
    registerBoolSetting("OnlyBottles", &onlyBottles, onlyBottles);
}

const char* FastUse::getRawModuleName() {
    return "FastUse";
}

vector<string> allowedItems = {
    "snowball",
    "bottle",
    "splash",
    "rod",
    "bow"
};
vector<string> bottlesOnly = {
    "bottle"
};

void FastUse::onTick(C_GameMode* gm) {
    auto player = g_Data.getLocalPlayer();
    if (player == nullptr || gm == nullptr) return;

    if (g_Data.canUseMoveKeys() && g_Data.isRightClickDown()) {
        C_ItemStack* stack = player->getSupplies()->inventory->getItemStack(player->getSupplies()->selectedHotbarSlot);
        if (stack->item != nullptr && (* stack->item)->itemId != 0) {

            string itemName = stack->getItem()->name.getText();
            if (!onlyBottles)
            {
                for (auto item : allowedItems) {
                    if (itemName.find(item) != string::npos) {
                        gm->useItem(*stack);
                    }
                }
            }
            if (onlyBottles) {
                for (auto item : bottlesOnly) {
                    if (itemName.find(item) != string::npos) {
                        gm->useItem(*stack);
                    }
                }
            }
        }
    }
}