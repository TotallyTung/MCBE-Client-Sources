#include "Phase.h"
float amountX = 0.85;
float amountZ = 0.85;
SettingEnum mode;
Phase::Phase() : IModule(0x0, Category::EXPLOIT, "Walk through walls") {
	registerEnumSetting("Mode", &mode, 0);
	mode.addEntry("Normal", 0);
	mode.addEntry("Clip", 1);
	registerFloatSetting("Offset X", &amountX, amountX, -0.1f, 1.f, 0.01f, "The amount to corner clip in the X value");
	registerFloatSetting("Offset Z", &amountZ, amountZ, -0.1f, 1.f, 0.01f, "The amount to corner clip in the Z value");
}

Phase::~Phase() {
}

const char* Phase::getRawModuleName() {
	return ("Phase");
}
const char* Phase::getModName()
{
	switch (mode.getSelectedValue())
	{
	case 0:
		name = " Normal";
		break;
	case 1:
		name = " Clip";
		break;
	}
	return name;
}
void Phase::onTick(C_GameMode* gm) {
	bool pressed = MoveUtil::keyPressed();
	if (pressed && mode.getSelectedValue() == 1)
		setEnabled(false);
	vec3_t Pos = vec3_t(floor(g_Data.getLocalPlayer()->getPos()->x), g_Data.getLocalPlayer()->getPos()->y, floor(g_Data.getLocalPlayer()->getPos()->z));
	Pos.x += amountX;
	Pos.z += amountZ;
	if (mode.getSelectedValue() == 1) {
		g_Data.getLocalPlayer()->setPos(Pos);
	}
	gm->player->aabb.upper.y = gm->player->aabb.lower.y;
}

void Phase::onDisable() {
	if (g_Data.getLocalPlayer() != nullptr)
		g_Data.getLocalPlayer()->aabb.upper.y += 1.8f;
}
